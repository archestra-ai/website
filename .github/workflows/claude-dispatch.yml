# IMPORTANT: Do not move this file in your repo! Make sure it's located at .github/workflows/claude-dispatch.yml
# Pulled from https://gist.github.com/ashwin-ant/869aea29676735afce576e1d24032629

name: Claude Code Dispatch

# IMPORTANT: Do not modify this `on` section!
on:
  repository_dispatch:
    types: [claude-dispatch]

jobs:
  claude-dispatch:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          fetch-depth: 1
          persist-credentials: false

      - name: Setup environment
        uses: ./.github/actions/setup-env

      - name: Run Claude Code
        id: claude
        # NOTE: for right now we're using the eap tag because that it what is present
        # in the GitHub gist that we're using (and I can't seem to find the eap tag in
        # Anthropic's repo)
        uses: anthropics/claude-code-action@eap # zizmor: ignore[unpinned-uses]
        with:
          mode: "remote-agent"

          # Optional: Specify an API key, otherwise we'll use your Claude account automatically
          # anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}

          model: "claude-opus-4-20250514"
          fallback_model: "claude-sonnet-4-20250514"

          # Optional: Allow Claude to run specific commands
          allowed_tools: |
            Bash(pnpm install)
            Bash(pnpm add:*)
            Bash(pnpm test)
            Bash(pnpm typecheck)
            Bash(pnpm codegen:*)
            Bash(pnpm prettier:*)

          # Optional: Custom environment variables for Claude
          # claude_env: |
          #   NODE_ENV: test
